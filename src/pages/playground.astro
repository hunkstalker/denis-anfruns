---
import ContentLayout from '@layouts/ContentLayout.astro'
import TSEditor from '@components/learn/TSEditor'

import JSIcon from '@icons/tech/javascript.svg?raw'
import TSIcon from '@icons/tech/typescript.svg?raw'

const multiFileExample = {
	'index.ts': `
import { User } from './types';

// Try changing the role to 'superadmin' to see the error!
const createUser = (name: string): User => {
    return {
        id: crypto.randomUUID(),
        name,
        email: \`\${name.toLowerCase()}@example.com\`,
        role: 'admin' 
    };
};

const user = createUser('Denis');
console.log(user);
`.trim(),

	'types.ts': `
export type ID = string;

export interface User {
    id: ID;
    name: string;
    email: string;
    role: 'admin' | 'user';
}
`.trim(),
}
---

<ContentLayout
	title="TypeScript Playground"
	description="Test your TypeScript skills"
	lang="es"
	robots="noindex, nofollow"
>
	<div
		id="secret-playground"
		style="display: none;"
		class="col-span-1 lg:col-span-10 lg:col-start-2"
	>
		<div class="mx-auto max-w-none text-center">
			<h1
				class="mb-12 flex flex-wrap items-center justify-center gap-4 text-3xl font-bold text-zinc-900 dark:text-white md:text-5xl"
			>
				Playground
				<div class="flex gap-3">
					<span
						class="inline-block h-8 w-8 overflow-hidden rounded-lg sm:h-10 sm:w-10"
						title="JavaScript"
						set:html={JSIcon}
					/>
					<span
						class="inline-block h-8 w-8 overflow-hidden rounded-lg sm:h-10 sm:w-10"
						title="TypeScript"
						set:html={TSIcon}
					/>
				</div>
			</h1>
		</div>
		<div class="mt-8">
			<TSEditor client:only="react" files={multiFileExample} height="800px" showConsole />
		</div>
	</div>

	<script is:inline>
		// Security Check: Immediate Execution
		const hasAccess = localStorage.getItem('playground_access') === 'granted'

		if (!hasAccess) {
			// Redirect immediately without history entry
			window.location.replace('/404')
		} else {
			// Reveal content when DOM is ready
			document.addEventListener('DOMContentLoaded', () => {
				const app = document.getElementById('secret-playground')
				if (app) {
					app.style.display = 'block'
					// Optional: Add a fade-in class if we had one, but block is fine for now
				}
			})
		}
	</script>
</ContentLayout>
