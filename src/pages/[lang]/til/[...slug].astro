---
import { type CollectionEntry, getCollection } from 'astro:content'
import BaseLayout from '../../../layouts/BaseLayout.astro'
import Nav from '../../../components/Nav.astro'
import ChevronLeft from '../../../icons/chevron-left.svg'
import { languages } from '../../../i18n/ui'
import { useTranslations } from '../../../i18n/utils'

export async function getStaticPaths() {
	const posts = await getCollection('til')
	const supportedLangs = Object.keys(languages).filter(lang => lang !== 'es')

	return posts
		.filter(post => supportedLangs.includes(post.data.lang))
		.map(post => {
      // slug is "folder/lang" -> we want "folder" as the URL slug
      const slug = post.slug.split('/')[0]
      return {
			  params: { 
				  lang: post.data.lang,
				  slug: slug
			  },
			  props: post,
		  }
    })
}
type Props = CollectionEntry<'til'>

const post = Astro.props
const { Content } = await post.render()
const { lang } = Astro.params
const t = useTranslations(lang)
---

<BaseLayout siteTitle={`TIL: ${post.data.title}`} lang={lang} description={post.data.title}>
	<Nav lang={lang} />

	<div class='container mx-auto px-4 py-8 pt-20 md:pt-28'>
		<div class='max-w-3xl mx-auto'>

      <div class="mb-8">
        <a href={`/${lang}/blog`} class='inline-flex items-center gap-2 text-sm font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-[--tangerine] transition-colors mb-6'>
          <ChevronLeft />
          {t('blog.backToBlog')}
        </a>
        
        <h1 class='text-3xl md:text-4xl font-bold dark:text-white mb-4 leading-tight'>{post.data.title}</h1>
        
        <div class='flex gap-3 text-sm text-zinc-500 font-mono border-b border-zinc-200 dark:border-zinc-800 pb-6'>
          <time datetime={post.data.pubDate.toISOString()}>
             {post.data.pubDate.toLocaleDateString(lang, { dateStyle: 'long' })}
          </time>
          <span>/</span>
          <div class="flex gap-2">
            {post.data.tags.map(tag => (
              <span>#{tag}</span>
            ))}
          </div>
        </div>
      </div>

			<article 
        class='prose dark:prose-invert prose-lg max-w-none'
        data-pagefind-body
        data-pagefind-filter="type:til"
      >
				<Content />
			</article>

      <div class="mt-12 pt-8 border-t border-zinc-200 dark:border-zinc-800">
        <a href={`/${lang}/blog`} class='inline-flex items-center gap-2 text-sm font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-[--tangerine] transition-colors'>
          <ChevronLeft />
          {t('blog.backToBlog')}
        </a>
      </div>
      
      <div class='h-24'></div>
		</div>
	</div>
</BaseLayout>
