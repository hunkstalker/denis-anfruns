---
import BaseLayout from '../../../layouts/BaseLayout.astro'
import Nav from '../../../components/layout/Nav.astro'
import { getTils } from '../../../utils/til-content'
import { useTranslations } from '../../../i18n/utils'
import { languages } from '../../../i18n/ui'
import type { SupportedLang } from '../../../utils/blogi18n'
import TilGrid from '../../../components/blog/TilGrid'

export async function getStaticPaths() {
	return Object.keys(languages)
		.filter((lang) => lang !== 'es')
		.map((lang) => ({ params: { lang: lang as SupportedLang } }))
}

const { lang } = Astro.params
const t = useTranslations(lang as SupportedLang)

const tilCollection = await getTils()
const tils = tilCollection
	.filter(p => p.data.lang === lang)
	.filter(p => p.data.lang === lang && p.data.pubDate)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())


---

<BaseLayout siteTitle={`TIL - ${t('blog.til')}`} lang={lang as SupportedLang}>
	<Nav lang={lang as SupportedLang} />
	<div class='container mx-auto px-3 py-6 pt-20 sm:px-4 sm:py-8 md:pt-28'>
		<div class='mx-auto max-w-5xl'>
			<div class="mb-6">
				<a
					href={lang === 'es' ? '/blog' : `/${lang}/blog`}
					class='items-center gap-2 text-sm font-medium text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-200 inline-flex transition-colors'
				>
					&larr; {t('blog.backToBlog')}
				</a>
			</div>

			<h1
				class='mb-6 flex items-center gap-2 border-b border-zinc-200 pb-2 text-3xl font-bold dark:border-zinc-700 dark:text-zinc-200'>
				{t('blog.til')}
			</h1>

			<p class='mb-8 text-lg text-zinc-500'>{t('blog.tilDescription')}</p>

			<TilGrid 
				client:load 
				posts={tils} 
				lang={lang as SupportedLang} 
				labels={{ 
					all: t('search.all'), 
					noResults: t('blog.withoutTILs'),
					readNote: t('blog.readNote')
				}} 
			/>
