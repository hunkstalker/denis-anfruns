---
import ContentLayout from '@layouts/ContentLayout.astro'
import BackLink from '@components/ui/BackLink.astro'
import { getDevlogs, groupDevlogsBySeries } from '@utils/devlogs-content'
import { getLangFromSlug } from '@utils/blogi18n'
import { useTranslations } from '@i18n/utils'
import DevLogGrid from '@components/devlog/Grid'

const lang = 'es'
const t = useTranslations(lang)

// Obtener y filtrar posts
const rawPosts = await getDevlogs()
const posts = rawPosts
	.filter((post) => getLangFromSlug(post.slug) === lang && post.data.pubDate)
	.filter((post) => (import.meta.env.PROD ? post.data.draft !== true : true))
const devlogs = groupDevlogsBySeries(posts)
---

<ContentLayout title={t('blog.series')} siteTitle={`DevLogs - ${t('site.title')}`} lang={lang}>
	<div class="lg:col-span-12">
		<div class="mb-8">
			<BackLink href={lang === 'es' ? '/blog' : `/${lang}/blog`} label={t('blog.back')} />

			<h1 class="mb-6 flex items-center gap-2 text-3xl font-bold dark:text-zinc-200">DevLogs</h1>

			<p class="text-lg text-zinc-500">{t('blog.devLogDescription')}</p>
			<hr class="animate-fade-in-up mt-8 border-stone-400 dark:border-zinc-800" />
		</div>

		{
			devlogs.length === 0 ? (
				<p class="italic text-zinc-500">
					{t('blog.withoutArticles') || 'No hay art√≠culos disponibles.'}
				</p>
			) : (
				<DevLogGrid
					client:load
					posts={devlogs}
					lang={lang}
					labels={{ readArticle: t('blog.readArticle') }}
				/>
			)
		}
	</div>
</ContentLayout>
