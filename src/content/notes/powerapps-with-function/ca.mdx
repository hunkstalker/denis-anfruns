---
title: Código más limpio con la función With
description: Define variables locales en fórmulas Power Fx para evitar repeticiones.
pubDate: '2025-12-03T00:00:00.000Z'
tags: ['powerapps', 'power-fx']
lang: ca
icon: powerapps
---

import CodeTabs from '../../../components/mdx/CodeTabs.astro'
import Callout from '../../../components/mdx/Callout.astro'

Quan una fórmula de `Patch` o `Filter` creix en complexitat, és habitual acabar repetint `User().Email` o `LookUp(...)` múltiples vegades, dificultant la lectura. La funció `With` és la solució per aplicar "Clean Code" a Power Apps.

Permet definir **variables locals** que només existeixen durant l'execució d'aquesta fórmula, fent el codi més llegible i eficient en evitar recalcular el mateix.

### Cas d'Ús: Creant un Registre Complex

Sense `With`, el codi es torna sorollós i repetitiu.

<CodeTabs 
  items={[
    { 
      label: 'Power Apps', 
      code: `// ❌ Repetitiu: Cridem a User() 4 vegades
Patch(Solicitudes, Defaults(Solicitudes), {
    Titulo: "Sol·licitud de " & User().FullName,
    EmailSolicitante: User().Email,
    Jefe: LookUp(Usuarios, Email = User().Email).Manager,
    Departamento: LookUp(Usuarios, Email = User().Email).Department
});

// ✅ Amb With: Definim el context una vegada
With({
// Scope: Variables locals calculades una sola vegada
CurrentUser: User(),
UserProfile: LookUp(Usuarios, Email = User().Email)
},
Patch(Solicitudes, Defaults(Solicitudes), {
Titulo: "Sol·licitud de " & CurrentUser.FullName,
EmailSolicitante: CurrentUser.Email,
Jefe: UserProfile.Manager,
Departamento: UserProfile.Department
})
);`,
lang: 'power fx'
}
]}
/>

És millor que crear variables de context (`UpdateContext`) que després has de recordar netejar. Fes-ho servir sempre que necessitis controlar l'scope de variables locals.

<Callout type="warning" title="Compte amb el separador" filled>
	Recorda que si tens Power Apps configurat per a la **regió europea** hauràs de canviar la coma `,`
	per punt i coma `;` a les fórmules. I doble punt i coma `;;` per als salts de línia on normalment
	es posaria únicament un punt i coma `;`.
</Callout>
