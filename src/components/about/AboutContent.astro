---
import { useTranslations } from '../../i18n/utils'
import ReactIcon from '../../icons/react.svg?raw'
import AstroIcon from '../../icons/astro-logo.svg?raw'
import PowerPlatformIcon from '../../icons/power-platform.svg?raw'
import PowerAppsIcon from '../../icons/power-apps.svg?raw'
import PowerAutomateIcon from '../../icons/power-automate.svg?raw'
import PowerBiIcon from '../../icons/power-bi.svg?raw'
import SharePointIcon from '../../icons/sharepoint.svg?raw'
import M365Icon from '../../icons/m-365.svg?raw'
import MailIcon from '../../icons/mail.svg'
import InvaderIcon from '../../icons/invader.svg'

import IconTrigger from './IconTrigger.astro'

interface Props {
	lang: 'es' | 'en' | 'ca'
}

const { lang } = Astro.props
const t = useTranslations(lang)

// AquÃ­ se definen las tecnologÃ­as que se mostrarÃ¡n en el About
const technologies = [
	{ name: 'React', id: 'hl-react', icon: ReactIcon, color: '#61DAFB', className: 'text-[#61DAFB]' },
	{ name: 'Astro', id: 'hl-astro', icon: AstroIcon, color: '#FF0080' },
	{ name: 'Power Platform', id: 'hl-power', icon: PowerPlatformIcon, color: '#00A36C' },
	{
		name: 'Power Apps',
		id: 'hl-apps',
		icon: PowerAppsIcon,
		color: '#D946EF',
		className: 'text-[#742774]',
	},
	{
		name: 'Power Automate',
		id: 'hl-automate',
		icon: PowerAutomateIcon,
		color: '#0078d4',
		className: 'text-[#0078d4]',
	},
	{
		name: 'Power BI',
		id: 'hl-bi',
		icon: PowerBiIcon,
		color: '#F2C811',
		className: 'text-[#F2C811]',
	},
	{
		name: 'SharePoint',
		id: 'hl-sp',
		icon: SharePointIcon,
		color: '#37C6D0',
		className: 'text-[#036C70]',
	},
	{
		name: 'Microsoft 365',
		id: 'hl-m365',
		icon: M365Icon,
		gradient: ['#50e6ff', '#0078D4', '#7FBA00', '#F25022', '#800080'].join(', '),
		className: 'text-[#036C70]',
	},
]

const processText = (text: string) => {
	let processed = text.replace(
		/\*\*(.*?)\*\*/g,
		'<strong class="font-bold text-zinc-900 dark:text-[--tangerine-hover]">$1</strong>',
	)

	technologies.forEach((tech) => {
		const regex = new RegExp(tech.name, 'g')
		processed = processed.replace(
			regex,
			`<span id="${tech.id}" class="transition-colors duration-300">${tech.name}</span>`,
		)
	})

	return processed
}
---

<div class="col-span-1 lg:col-span-8 lg:col-start-3">
	<h1
		class="mb-12 text-3xl font-bold tracking-tight text-zinc-900 dark:text-white md:text-5xl"
		style={{ textWrap: 'balance' }}
	>
		{t('about.title')}
	</h1>

	<div class="prose prose-lg max-w-none space-y-16 dark:prose-invert">
		<section class="animate-fade-in-up">
			<h2 style={{ textWrap: 'balance' }}>
				<span
					set:html={t('about.intro.title').replace(
						',',
						`, <span class="animate-wave ml-2 inline-block origin-[70%_70%]">ðŸ––</span><br class="block sm:hidden" />`,
					)}
				/>
			</h2>
			<p set:html={processText(t('about.intro.text'))} />

			<div
				class="not-prose mt-8 flex flex-wrap justify-center gap-4 sm:flex-nowrap sm:justify-start sm:gap-6"
			>
				{
					technologies.map((tech) => (
						<IconTrigger
							icon={tech.icon}
							targetId={tech.id}
							highlightColor={tech.color}
							gradient={tech.gradient}
							class={tech.className}
						/>
					))
				}
			</div>

			<p class="mt-6" set:html={processText(t('about.intro.deal'))} />
		</section>

		<section class="animate-fade-in-up delay-100">
			<h2>
				{t('about.garden.title')}
			</h2>
			<p set:html={processText(t('about.garden.text'))} />
		</section>

		<section class="animate-fade-in-up delay-200">
			<h2>
				{t('about.personal.title')}
				<InvaderIcon class="animate-bounce-slow ml-2 inline-block size-6 text-zinc-800 dark:text-white" />
			</h2>
			<p set:html={processText(t('about.personal.text'))} />
		</section>

		<section class="animate-fade-in-up delay-300">
			<h2>
				{t('about.contact.title')}
				
			</h2>
			<p set:html={t('about.contact.text')} />

			<p class="mt-4">
				<a 
					id="email-link" 
					href="#" 
					class="font-medium text-[--tangerine-hover] no-underline transition-colors hover:text-[--tangerine] dark:text-[--tangerine] dark:hover:text-[--tangerine-hover]"
				>
					<!-- Email loaded via JS to prevent scraping -->
				</a>
				<MailIcon class="ml-2 inline-block size-6" />
			</p>
		</section>
	</div>
</div>

<script>
	// Obfuscated email to prevent scraping
	const emailLink = document.getElementById('email-link')
	if (emailLink) {
		const user = 'anfruns.denis'
		const domain = 'gmail.com'
		const email = `${user}@${domain}`
		emailLink.textContent = email
		emailLink.setAttribute('href', `mailto:${email}`)
	}
</script>

<style>
	.animate-fade-in-up {
		opacity: 0;
		animation: fadeInUp 0.8s ease-out forwards;
	}

	.delay-100 {
		animation-delay: 0.2s;
	}
	.delay-200 {
		animation-delay: 0.4s;
	}

	@keyframes gradient-move {
		0% {
			background-position: 0% 50%;
		}
		100% {
			background-position: 66.666% 50%;
		}
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	@keyframes float {
		0%,
		100% {
			transform: translateY(0);
		}
		50% {
			transform: translateY(-5px);
		}
	}
	.animate-bounce-slow {
		animation: float 3s ease-in-out infinite;
	}
</style>
