---
import infoIcon from '../../icons/info-circle.svg?raw'
import warningIcon from '../../icons/warning-triangle.svg?raw'
import errorIcon from '../../icons/error-circle.svg?raw'
import successIcon from '../../icons/check-circle.svg?raw'

interface Props {
	type?: 'info' | 'warning' | 'error' | 'success'
	title?: string
	filled?: boolean | string
	icon?: boolean
}

const { type = 'info', title, filled = false, icon = true } = Astro.props
const isFilled = filled === true || filled === '' || filled === 'true'

const icons = {
	info: infoIcon,
	warning: warningIcon,
	error: errorIcon,
	success: successIcon,
}

const styles = {
	info: {
		container: isFilled
			? 'bg-blue-100 dark:bg-blue-500/30 border-2 border-blue-500 text-blue-900 dark:text-blue-100'
			: 'bg-blue-50 dark:bg-blue-500/10 border border-blue-200 dark:border-blue-500/20 text-blue-900 dark:text-blue-200',
		iconColor: isFilled ? 'text-blue-700 dark:text-blue-300' : 'text-blue-600 dark:text-blue-400',
	},
	warning: {
		container: isFilled
			? 'bg-amber-100 dark:bg-amber-500/30 border-2 border-amber-500 text-amber-900 dark:text-amber-100'
			: 'bg-amber-50 dark:bg-amber-500/10 border border-amber-200 dark:border-amber-500/20 text-amber-900 dark:text-amber-200',
		iconColor: isFilled
			? 'text-amber-700 dark:text-amber-300'
			: 'text-amber-600 dark:text-amber-400',
	},
	error: {
		container: isFilled
			? 'bg-red-100 dark:bg-red-500/30 border-2 border-red-500 text-red-900 dark:text-red-100'
			: 'bg-red-50 dark:bg-red-500/10 border border-red-200 dark:border-red-500/20 text-red-900 dark:text-red-200',
		iconColor: isFilled ? 'text-red-700 dark:text-red-300' : 'text-red-600 dark:text-red-400',
	},
	success: {
		container: isFilled
			? 'bg-green-100 dark:bg-green-500/30 border-2 border-green-500 text-green-900 dark:text-green-100'
			: 'bg-green-50 dark:bg-green-500/10 border border-green-200 dark:border-green-500/20 text-green-900 dark:text-green-200',
		iconColor: isFilled
			? 'text-green-700 dark:text-green-300'
			: 'text-green-600 dark:text-green-400',
	},
}

const colors = {
	info: '#3b82f6',
	warning: '#f59e0b',
	error: '#ef4444',
	success: '#22c55e',
}
const baseColor = colors[type]
const inlineStyle = isFilled
	? `border: 2px solid ${baseColor}; background-color: ${baseColor}30;`
	: ''

const currentStyle = styles[type]

// Title Logic:
// undefined -> Default Capitalized Type
// "" -> Hidden
// "Valid string" -> Use string
const getTitle = () => {
	if (title === undefined) return type.charAt(0).toUpperCase() + type.slice(1)
	return title
}

const displayTitle = getTitle()
---

<div class={`p-4 rounded-xl ${currentStyle.container} relative my-6 shadow-sm`} style={inlineStyle}>
	{(displayTitle || icon) && (
		<div class="flex items-center gap-2 mb-2">
			{displayTitle && <h5 class="font-bold m-0">{displayTitle}</h5>}
			{icon && (
				<div
					class={`shrink-0 size-5 ${currentStyle.iconColor} [&>svg]:w-full [&>svg]:h-full`}
				>
					<Fragment set:html={icons[type]} />
				</div>
			)}
		</div>
	)}

	<div
		class="prose prose-sm max-w-none text-sm leading-relaxed dark:prose-invert prose-p:my-0 prose-ol:my-0 prose-ul:my-0"
	>
		<slot />
	</div>
</div>
