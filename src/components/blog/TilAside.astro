---

import { useTranslations } from '../../i18n/utils'
import { getTils } from '../../utils/til-content'
import ArrowLink from '../../icons/arrow-link.svg'
import BlogTilList from './BlogTilList'

interface Props {
	lang: 'es' | 'en' | 'ca'
	limit?: number
}

const { lang, limit } = Astro.props
const t = useTranslations(lang)

const tilCollection = await getTils()
const allTils = tilCollection
	.filter(p => p.data.lang === lang)
	.filter(p => p.data.lang === lang && p.data.pubDate)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())

const displayedTils = limit ? allTils.slice(0, limit) : allTils
const showViewAll = limit && allTils.length > limit
---

<style>
	.animate-fade-in-up {
		animation: fadeInUp 0.5s ease-out both;
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
</style>

<aside class='space-y-6 sm:space-y-8 lg:col-span-4'>
	<div
		class='rounded-xl lg:border lg:border-zinc-200 lg:bg-zinc-50 lg:p-6 lg:dark:border-zinc-800 lg:dark:bg-zinc-900/50'>
		<div class="flex items-center justify-between border-b border-zinc-200 pb-2 dark:border-zinc-700">
			<h2
				class='flex items-center gap-2 text-xl font-bold dark:text-zinc-200'>
				{t('blog.til')}
			</h2>
			{showViewAll && (
				<a href={lang === 'es' ? '/til' : `/${lang}/til`} data-astro-prefetch="hover" class="group flex items-center gap-2 text-sm font-medium text-zinc-500 transition-colors hover:text-zinc-900 dark:hover:text-[--tangerine]">
					{t('home.view.all')}
					<ArrowLink class='h-4 w-4 transition-transform group-hover:translate-x-1' />
				</a>
			)}
		</div>

		<p class='mb-6 mt-2 text-base text-zinc-500'>{t('blog.tilDescription')}</p>

		<div class='space-y-4'>
			{displayedTils.length === 0 && <p class='text-sm italic text-zinc-500'>{t('blog.withoutTILs')}</p>}

			<BlogTilList client:load posts={displayedTils} lang={lang} labels={{ readNote: t('blog.readNote') }} />
		</div>
	</div>
</aside>
