---

import { useTranslations } from '../../i18n/utils'
import { getTils } from '../../utils/til-content'
import ArrowLink from '../../icons/arrow-link.svg'

interface Props {
	lang: 'es' | 'en' | 'ca'
}

const { lang } = Astro.props
const t = useTranslations(lang)

const tilCollection = await getTils()
const tils = tilCollection
	.filter(p => p.data.lang === lang)
	.filter(p => p.data.lang === lang && p.data.pubDate)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
---

<style>
	.animate-fade-in-up {
		animation: fadeInUp 0.5s ease-out both;
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
</style>

<aside class='space-y-6 sm:space-y-8 lg:col-span-4'>
	<div
		class='rounded-xl lg:border lg:border-zinc-200 lg:bg-zinc-50 lg:p-6 lg:dark:border-zinc-800 lg:dark:bg-zinc-900/50'>
		<h2
			class='flex items-center gap-2 border-b border-zinc-200 pb-2 text-xl font-bold dark:border-zinc-700 dark:text-zinc-200'>
			{t('blog.til')}
		</h2>

		<p class='mb-6 mt-2 text-base text-zinc-500'>{t('blog.tilDescription')}</p>

		<div class='space-y-4'>
			{tils.length === 0 && <p class='text-sm italic text-zinc-500'>{t('blog.withoutTILs')}</p>}

			{
				tils.map((post, index) => (
					<article
						class='til-card animate-fade-in-up group relative flex flex-col gap-2 rounded-xl border border-zinc-200 bg-white p-4 shadow-sm transition-shadow duration-300 hover:border-black/15 hover:shadow-md dark:border-zinc-700/50 dark:bg-zinc-800 dark:hover:border-white/15'
						style={`animation-delay: ${index * 100}ms`}>
						<div class='mb-1 flex items-center justify-between gap-2'>
							<time
								class='text-xs flex items-center gap-3 text-zinc-500'
								datetime={post.data.pubDate.toISOString()}>
								{post.data.pubDate.toLocaleDateString(undefined, {
									month: 'short',
									day: 'numeric',
									year: 'numeric',
								})}
							</time>
						</div>

						<p class='mb-4 line-clamp-2 dark:text-white'>
							<a
								href={
									lang === 'es'
										? `/til/${post.slug.split('/')[0]}/`
										: `/${lang}/til/${post.slug.split('/')[0]}/`
								}>
								<span class='absolute inset-0' />
								{post.data.title}
							</a>
						</p>
						<div class='flex items-center gap-2 text-sm font-medium text-[--tangerine-hover] dark:text-[--tangerine]'>
							Leer nota
							<ArrowLink />
						</div>
					</article>
				))
			}
		</div>
	</div>
</aside>
